# api_yamdb
## Оглавление:
- [Стек технологий.](Стек-технологий)
- [Краткое описание проекта.](Краткое-описание-проекта)
- [Как запустить проект.](Как-запустить-проект)
- [Как наполнить БД данными](Как-наполнить-БД-данными)
- [Примеры запросов к API.](Примеры-запросов-к-API)
- [Доступ к документации по API](Доступ-к-документации-по-API)

## Стек технологий
- Python
- Django
- DRF
- JWT токены
- Проект написан на Linux

## Краткое описание проекта:
Данный проект является учебным и представляет из себя API с отзывами на книги, фильмы, песни итп.
У всех произведений есть категории и жанры.

В проекте есть несколько основных уровней доступа:
- Пользователь.
- Модератор.
- Администратор.

Пользователи могут:
- Регистрироваться.
- Создавать, редактировать и удалять свои отзывы на произведения.
- Комментировать отзывы.
- Редактировать и удалять свои комментарии.

Модераторы могут:
- Удалять и редактировать любы отзывы и комментарии (плюс все то, что могут пользователи).

Администраторы могут:
- Создавать новых пользователей.
- Создавать и удалять произведения, категории и жанры.

Основные цели проекта:
1. Потренироваться работать в команде, в том числе используя систему контроля версий git и ее онлайн репозиторий git hub.
2. Применить теоретичесие знания на практике, используя принцип API First.


## Как запустить проект:

Клонировать репозиторий и перейти в него в командной строке:

```
git clone git@github.com:sanfootball/api_yamdb.git
```

```
cd api_yamdb
```

Cоздать и активировать виртуальное окружение:

```
python -m venv venv
```

```
. venv/Scripts/activate
```

Установить зависимости из файла requirements.txt:

```
pip install --upgrade pip
```

```
pip install -r requirements.txt
```

Выполнить миграции:

```
python manage.py migrate
```

Запустить проект:

```
python manage.py runserver
```

## Как наполнить БД данными:
Перейти в папку api_yamdb, где находится файл manage.py и дать команду на заполнение:

```
python manage.py csv_to_db
```


## Примеры запросов к API:

**Добавление нового отзыва**
Добавить новый отзыв. Пользователь может оставить только один отзыв на произведение. Права доступа: Аутентифицированные пользователи.

Вместо {title_id} указать номер интересующего произведения.
В поле оценка (score) указывается целое число от 1 до 10.
В поле текст (text) указывается текст отзыва.

Тип запроса: POST

#URL:
```
http://127.0.0.1:8000/api/v1/titles/{title_id}/reviews/
```
#Пример запроса:
{
  "text": "string",
  "score": 1
}

#Пример успешного ответа:
{
  "id": 0,
  "text": "string",
  "author": "string",
  "score": 1,
  "pub_date": "2019-08-24T14:15:22Z"
}

**Получение комментария к отзыву**
Получить комментарий для отзыва по id. Права доступа: Доступно без токена.

Вместо {title_id} указать номер интересующего произведения.
Вместо {review_id} указать номер интересующего отзыва к произведению.
Вместо {comment_id} указать номер интересующего комментария к отзыву.

Тип запроса: GET

#URL:
```
http://127.0.0.1:8000/api/v1/titles/{title_id}/reviews/{review_id}/comments/{comment_id}/
```
#Пример ответа (успешный, код 200):
{
  "id": 0,
  "text": "string",
  "author": "string",
  "pub_date": "2019-08-24T14:15:22Z"
}


## Доступ к документации по API:
Перейти в папку api_yamdb, где находится файл manage.py и выполнить команду:

```
python3.9 manage.py runserver
```
Далее в браузере ввести ссылку:
```
http://127.0.0.1:8000/redoc/
```

_Дополнительная информация_

_Postman-коллекция для проверки API_

Файл `Ymdb-collection.postman_collection.json` содержит postman-коллекцию - набор заранее подготовленных запросов для проверки работы API.

_Подготовка Django-проекта к запуску коллекции:_
1. Проверьте, что виртуальное окружение развёрнуто и активировано, зависимости проекта установлены.
2. Перейдите в директорию *postman_collection* и командой `bash set_up_data.sh`` запустите bash-скрипт, который создаст в базе данных объекты, необходимые для работы коллекции.  
*Внимание, скрипт предварительно очищает существующую базу данных.*
3. Перейдите в директорию с файлом `manage.py` и запустите сервер разработки.

_Загрузка коллекции в Postman:_

1. Запустите Postman;
2. В левом верхнем углу нажмите `File` -> `Import`;
3. Во всплывающем окне будет предложено перетащить в него файл с коллекцией либо выбрать файл через окно файлового менеджера.
Загрузите в Postman файл `Ymdb-collection.postman_collection.json`.

_Запуск коллекции_

**Запускать коллекцию можно только после того, как в коде проекта вы реализуете регистрацию пользователей.** 
К моменту запуска коллекции в проекте должны работать:
- отправка кода подтверждения, 
- повторная отправка кода подтверждения
- получение токена.

В ином случае значительная часть запросов вернётся с ошибкой: коллекция рассчитана на полную готовность функционала проекта.
  
1. После выполнения предыдущих шагов, в левой части окна Postman во вкладке `Collections` появилась импортированная коллекция.
Нажмите на её название, чтобы увидеть содержимое, и найдите директорию *Ymdb-collection/registration // No Auth/get_confirmatior_codes*.
Наведите на нее курсор, нажмите на три точки напротив названия директории и в выпадающем списке выберите `Run folder`. В центре экрана появится список из четырех запросов.
Выполните их, нажав кнопку `Run <название коллекции>`;
2. После выполнения предыдущего шага ваше приложение должно сформировать коды подтверждения для 4-х пользователей. Сохраните полученные коды в переменные коллекции:
- нажмите на название коллекции,
- в появившемся в центре экрана окне перейдите во вкладку `Variables`. 

Заполните колонку `Current_value` для первых четырех переменных.  

| Название переменной | email, использованный при регистрации пользователя |
| ------ | ------ |
| userConfirmationCode | user@no-admin.ru |
| moderatorConfirmationCode | moderator@admin.ru |
| adminConfirmationCode | admin-user@admin.ru |
| superuserConfirmationCode | superuser@admin.ru |

*Не забудьте сохранить изменения.*  
3. Для запуска коллекции наведите на нее курсор, нажмите на три точки напротив названия коллекции и в выпадающем списке выберите `Run collection`.
В появившемся окне отключите первые четыре запроса (они уже были выполнены на первом этапе).  
4. В правом меню включите фунцию `Persist responses for a session` - это даст возможность посмотреть ответы API после запуска коллекции;  
5. Нажмите кнопку `Run <название коллекции>`;  
6. В центре экрана отобразится результат запуска коллекции и тестов. Провалившиеся тесты можно отфильтровать, перейдя во вкладку `Failed`.  
Посмотрите детали выполненного запроса и полученного ответа: для этого нажмите на тест.
  

P.S. После успешного выполнения всех запросов коллекции в базе данных останутся 4 пользователя. Это не помешает повторному запуску коллекции.

Если какие-то запросы завершатся ошибкой, в базе данных могут остаться и иные объекты, способные повлиять на корректность повторного запуска коллекции. В таком случае перед следующим запуском коллекции рекомендуется вновь запустить bash-скрипт и выполнить шаги по настройке коллекции, описанные в начале инструкции.
